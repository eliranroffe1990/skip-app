<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SKIPAPP</title>
  <meta name="theme-color" content="#FFD8BE"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="apple-touch-icon" href="icon/icon-180.png"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="SKIPAPP"/>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet"/>
  <style>
    :root{--cream:#FFF4E6; --peach:#FFD8BE; --blush:#F9C6C9; --sage:#DDE8D1; --lav:#E6D7FF; --text:#1A202C; --muted:#64748B; --card:#FFFFFF; --border:#E2E8F0; --accent:#06B6D4; --accent2:#4F46E5}
    *{box-sizing:border-box}
    body{margin:0;color:var(--text);font-family:'Heebo',system-ui; background: var(--cream)}
    header{position:sticky; top:0; z-index:10; background:rgba(255,255,255,.86); backdrop-filter:blur(8px); border-bottom:1px solid var(--border)}
    .topbar{max-width:940px;margin:0 auto;display:flex;gap:8px;align-items:center;padding:10px}
    .iconbtn{background:#fff;border:1px solid var(--border);border-radius:10px;padding:8px;cursor:pointer;box-shadow:0 6px 16px rgba(17,24,39,.08)}
    .iconbtn svg{width:22px;height:22px;fill:#0F766E}
    main{max-width:940px;margin:0 auto;padding:20px}
    .card{background:var(--card);border-radius:16px;padding:22px;border:1px solid var(--border);box-shadow:0 10px 24px rgba(17,24,39,.08)}
    .btn{appearance:none;border:none;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#fff;padding:12px 18px;cursor:pointer;font-weight:700; box-shadow:0 10px 24px rgba(79,70,229,.18)}
    .btnSecondary{appearance:none;border:1px solid var(--border);border-radius:999px;background:#fff;color:#0F766E;padding:10px 16px;cursor:pointer;font-weight:700}
    .tile{display:block;text-decoration:none;background:linear-gradient(180deg,#FFFFFF,#FAFAFF);border:1px solid var(--border);border-radius:14px;padding:14px;text-align:center;font-weight:700;color:#0F766E;box-shadow:0 8px 18px rgba(17,24,39,.08)}
    .list{display:flex;flex-direction:column;gap:10px}
    .hint{color:var(--muted);font-size:.95rem}
    .brandWrap{display:flex;flex-direction:column;align-items:center;gap:8px}
    .brandName{font-weight:800;font-size:1.6rem;margin:0;color:#0F766E}
    .brandLogo{width:120px;height:120px}
    table{width:100%;border-collapse:collapse}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:10px}
    .stat{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:#F1F5F9;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:.9rem}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    select, input[type=text], input[type=number]{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <button class="iconbtn" onclick="App.goBack()" title="חזרה">
        <svg viewBox="0 0 24 24"><path d="M19 11H7.83l4.59-4.59L11 5l-7 7 7 7 1.41-1.41L7.83 13H19v-2z"/></svg>
      </button>
      <button class="iconbtn" onclick="App.goHome()" title="מסך הבית">
        <svg viewBox="0 0 24 24"><path d="M12 3l9 8h-3v9h-4v-6H10v6H6v-9H3z"/></svg>
      </button>
    </div>
  </header>

  <main id="app"></main>

  <!-- דיאגנוסטיקה לשגיאות -->
  <script>
    (function(){
      const s="position:fixed;right:12px;bottom:12px;max-width:60vw;z-index:9999;background:#fff;border:1px solid #e11d48;border-radius:10px;padding:10px;box-shadow:0 10px 24px rgba(17,24,39,.12);direction:ltr;font:12px/1.3 ui-monospace,Consolas,monospace;";
      const box=document.createElement('div'); box.id='_diag'; box.style=s+'display:none;';
      document.addEventListener('DOMContentLoaded',()=>document.body.appendChild(box));
      function show(m){box.style.display='block'; const p=document.createElement('div'); p.textContent=m; box.appendChild(p); console.error('[SKIPAPP]',m);}
      window.addEventListener('error',e=>show(e.message||e.error||'Error'));
      window.addEventListener('unhandledrejection',e=>show('Promise: '+(e.reason&&e.reason.message||e.reason||'unhandledrejection')));
    })();
  </script>

  <!-- אפליקציה v4.8: שפות + שמור והמשך בכל מסך -->
  <script>
  const strings={
    he:{
      continue:'המשך', save_next:'שמור והמשך', home:'בית', back:'חזרה', add_skip:'הוסף דילוג', history:'היסטוריה', insights:'תובנות', investments:'אפיקי השקעה', settings:'הגדרות',
      amount:'סכום (₪)', description:'תיאור', category:'קטגוריה', save:'שמור', reset_all:'איפוס נתונים',
      welcome_home:'ברוך שובך', register:'הרשמה', name:'שם', age:'גיל', goal:'יעד חיסכון חודשי (₪)', purpose:'מטרת חיסכון', language:'שפה',
      choose_lang:'בחר/י שפה', lang_he:'עברית', lang_en:'English',
      entry_title:'ברוך הבא ל־SKIPAPP',
      entry_intro_1:'SKIPAPP – אפליקציה שעוקבת ומדלגת אחרי הוצאות לא הכרחיות.',
      entry_intro_2:'מעקב אחרי הדילוגים וצבירת סכומים שנחסכו לאורך זמן.',
      entry_intro_3:'הכוונה לאפיקי השקעה חכמים בשפה פשוטה.',
      start:'התחל', go_home:'עבור למסך הבית', go_register:'עבור להרשמה', total:'שווי חיסכון מלא: ₪', terms_title:'תנאי שימוש',
      terms_text:'האפליקציה נועדה לשימוש חינוכי ולמידה על חסכון כסף.'
    },
    en:{
      continue:'Continue', save_next:'Save & Continue', home:'Home', back:'Back', add_skip:'Add Skip', history:'History', insights:'Insights', investments:'Investments', settings:'Settings',
      amount:'Amount (₪)', description:'Description', category:'Category', save:'Save', reset_all:'Reset Data',
      welcome_home:'Welcome back', register:'Register', name:'First name', age:'Age', goal:'Monthly saving goal (₪)', purpose:'Saving purpose', language:'Language',
      choose_lang:'Choose language', lang_he:'Hebrew', lang_en:'English',
      entry_title:'Welcome to SKIPAPP',
      entry_intro_1:'SKIPAPP tracks and skips non-essential expenses.',
      entry_intro_2:'Keep a running log of your skips and see your savings grow.',
      entry_intro_3:'Guidance to smart investment avenues, in simple language.',
      start:'Start', go_home:'Go to Home', go_register:'Go to Register', total:'Total saved: ₪', terms_title:'Terms of Use',
      terms_text:'This app is intended for educational use to learn about money saving.'
    }
  };

  function formatDate(iso){ try{const d=new Date(iso); if(isNaN(d)) return '—'; return d.toLocaleDateString(App.state.lang==='he'?'he-IL':'en-US');}catch{return '—';}}
  const csvQuote=(v)=> '"'+String(v).replace(/"/g,'""')+'"';

  const App={ state:{screen:'entry',historyStack:[],user:null,lang:'he',data:[]},
    t(k){return strings[this.state.lang][k]||k},
    setLang(l){ this.state.lang = (l==='en'?'en':'he'); document.documentElement.setAttribute('lang', this.state.lang==='he'?'he':'en'); document.documentElement.setAttribute('dir', this.state.lang==='he'?'rtl':'ltr'); this.render(); },
    push(s){this.state.historyStack.push(this.state.screen); this.state.screen=s; this.render();},
    goBack(){ if(this.state.historyStack.length){ this.state.screen=this.state.historyStack.pop(); this.render(); } else { this.goHome(); } },
    goHome(){ this.state.screen='home'; this.render(); },
    next(){ const order=['entry','home','addSkip','history','insights','investments','summary']; const i=order.indexOf(this.state.screen); this.state.screen = order[Math.min(i+1,order.length-1)]||'home'; this.render(); },
    saveUser(u){ localStorage.setItem('skipapp_user',JSON.stringify(u)); this.state.user=u; },
    saveData(){ localStorage.setItem('skipapp_data',JSON.stringify(this.state.data)); },
    exportCSV(){ const rows=this.state.data.slice().reverse(); const header=this.state.lang==='he'?['תאריך','סכום','קטגוריה','תיאור']:['Date','Amount','Category','Description']; const lines=[header.join(',')]; rows.forEach(r=>lines.push([formatDate(r.date),(r.amount||0),csvQuote(r.category||''),csvQuote(r.description||'')].join(','))); const blob=new Blob(["\ufeff"+lines.join('\n')],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='skipapp_history.csv'; a.click(); URL.revokeObjectURL(a.href); },
    exportJSON(){ const blob=new Blob([JSON.stringify(this.state.data,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='skipapp_history.json'; a.click(); URL.revokeObjectURL(a.href); },
    reset(){ if(!confirm(this.state.lang==='he'?'לאפס את כל הנתונים?':'Reset all data?')) return; localStorage.removeItem('skipapp_data'); this.state.data=[]; this.saveData(); this.render(); },
    load(){ try{ const u=localStorage.getItem('skipapp_user'); this.state.user = u ? JSON.parse(u) : null; } catch(e){ console.warn('user parse failed', e); localStorage.removeItem('skipapp_user'); this.state.user=null; } try{ const d=localStorage.getItem('skipapp_data'); const arr = d ? JSON.parse(d) : []; this.state.data = Array.isArray(arr) ? arr : []; } catch(e){ console.warn('data parse failed', e); localStorage.removeItem('skipapp_data'); this.state.data=[]; } this.state.screen='entry'; this.render(); },
    addSkip(item){ this.state.data.push(item); this.saveData(); this.state.screen='history'; this.render(); },
    gQuery(q){ const enc = encodeURIComponent(q); return 'https://www.google.com/search?q='+enc; },
    render(){ const el=document.getElementById('app'); let html=''; const t=(k)=>this.t(k); const total=this.state.data.reduce((s,x)=>s+(x.amount||0),0);
      // ENTRY screen with language picker + intro + continue
      if(this.state.screen==='entry'){
        html = `<section class="card" style="text-align:center">
          <div class="brandWrap">
            <h2 class="brandName">SKIPAPP · ${t('entry_title')}</h2>
            <img src="images/play_logo.png" alt="PLAY" class="brandLogo"/>
          </div>
          <img src="images/hero.jpg" alt="SKIPAPP" style="width:100%;border-radius:12px;margin-top:8px"/>
          <p class="hint" style="margin-top:10px">${t('entry_intro_1')}</p>
          <p class="hint">${t('entry_intro_2')}</p>
          <p class="hint">${t('entry_intro_3')}</p>
          <div class="row" style="margin-top:12px">
            <label class="hint">${t('language')}</label>
            <select id="lang" onchange="App.setLang(this.value)" style="max-width:240px">
              <option value="he">${t('lang_he')}</option>
              <option value="en">${t('lang_en')}</option>
            </select>
          </div>
          <div class="row" style="margin-top:12px;justify-content:center">
            <button class="btn" onclick="App.goHome()">${t('go_home')}</button>
            <button class="btnSecondary" onclick="App.push('register')">${t('go_register')}</button>
          </div>
          <div style="margin-top:12px"><button class="btn" onclick="App.next()">${t('save_next')}</button></div>
        </section>`;
      }
      else if(this.state.screen==='register'){
        const u=this.state.user||{firstName:'',age:'',goal:0,purpose:''};
        const opts=strings[this.state.lang].purpose_opts;
        html = `<section class="card">
          <h2>${t('register')}</h2>
          <label class="hint">${t('name')}</label>
          <input id="fn" type="text" value="${u.firstName||''}"/>
          <label class="hint" style="margin-top:8px">${t('age')}</label>
          <input id="age" type="number" min="10" max="99" value="${u.age||''}"/>
          <label class="hint" style="margin-top:8px">${t('goal')}</label>
          <input id="goal" type="number" min="0" value="${u.goal||''}" placeholder="1000"/>
          <label class="hint" style="margin-top:8px">${t('purpose')}</label>
          <select id="purpose">${opts.map(o=>`<option>${o}</option>`).join('')}</select>
          <div class="row" style="margin-top:12px">
            <button class="btn" onclick="(function(){ const user={ firstName:document.getElementById('fn').value.trim(), age:parseInt(document.getElementById('age').value||0), goal:parseFloat(document.getElementById('goal').value||0), purpose:document.getElementById('purpose').value, registeredAt:new Date().toISOString() }; if(!user.firstName||!user.age||isNaN(user.goal)){ alert(App.state.lang==='he'?'אנא מלא/י את כל השדות':'Please fill all fields'); return;} App.saveUser(user); App.goHome(); })()">${t('save')}</button>
            <button class="btn" onclick="App.next()">${t('save_next')}</button>
          </div>
        </section>`;
      }
      else if(this.state.screen==='home'){
        const name=this.state.user?.firstName||'';
        html = `<section class="card" style="text-align:center">
          <div class="brandWrap">
            <h2 class="brandName">SKIPAPP${name?` · ${t('welcome_home')} ${name}`:''}</h2>
            <img src="images/play_logo.png" alt="PLAY" class="brandLogo"/>
          </div>
          <img src="images/hero.jpg" alt="SKIPAPP" style="width:100%;border-radius:12px;margin-top:8px"/>
          <div class="list" style="margin-top:12px">
            <a class="tile" href="javascript:void(0)" onclick="App.push('addSkip')">${t('add_skip')}</a>
            <a class="tile" href="javascript:void(0)" onclick="App.push('history')">${t('history')}</a>
            <a class="tile" href="javascript:void(0)" onclick="App.push('insights')">${t('insights')}</a>
            <a class="tile" href="javascript:void(0)" onclick="App.push('investments')">${t('investments')}</a>
            <a class="tile" href="javascript:void(0)" onclick="App.push('settings')">${t('settings')}</a>
          </div>
          <p class="hint" style="margin-top:8px">${t('total')}${total.toFixed(2)}</p>
          <div style="margin-top:12px"><button class="btn" onclick="App.next()">${t('save_next')}</button></div>
        </section>`;
      }
      else if(this.state.screen==='addSkip'){
        html = `<section class="card">
          <h2>${t('add_skip')}</h2>
          <label class="hint">${t('amount')}</label>
          <input id="amt" type="number" min="1"/>
          <label class="hint" style="margin-top:8px">${t('description')}</label>
          <input id="desc" type="text"/>
          <label class="hint" style="margin-top:8px">${t('category')}</label>
          <select id="cat">
            ${['אוכל ושתייה','אופנה','בילויים','טכנולוגיה','יופי וטיפוח','תחבורה','מנויים','קניות אימפולסיביות','חברתי','אחר'].map(o=>`<option>${o}</option>`).join('')}
          </select>
          <p class="hint" style="margin-top:10px">${this.state.lang==='he'?'הנתונים נשמרים אוטומטית ומצטברים לכל כניסה.':'Data is saved automatically and accumulates across sessions.'}</p>
          <div class="row" style="margin-top:12px">
            <button class="btn" onclick="(function(){ const item={ amount:parseFloat(document.getElementById('amt').value||0), description:document.getElementById('desc').value.trim(), category:document.getElementById('cat').value, date:new Date().toISOString() }; if(!item.amount||!item.description){ alert(App.state.lang==='he'?'נא להזין סכום ותיאור':'Please enter amount and description'); return;} App.addSkip(item); })()">${t('save')}</button>
            <button class="btn" onclick="App.next()">${t('save_next')}</button>
          </div>
        </section>`;
      }
      else if(this.state.screen==='history'){
        const rows=this.state.data.slice().reverse();
        const hdr = this.state.lang==='he'?['תאריך','סכום (₪)','קטגוריה','תיאור']:['Date','Amount (₪)','Category','Description'];
        html = `<section class="card">
          <h2>${t('history')}</h2>
          <div class="stat"><span class="chip">${this.state.lang==='he'?'סך הכל':'Total'}: ₪${total.toFixed(2)}</span><button class="btn" onclick="App.exportCSV()">CSV</button><button class="btn" style="background:linear-gradient(90deg,var(--honey),var(--peach));color:#1F2937" onclick="App.exportJSON()">JSON</button></div>
          <div style="margin-top:10px">
            <table>
              <thead><tr style="background:#fff6f2">${hdr.map(h=>`<th style='text-align:${App.state.lang==='he'?'right':'left'};padding:8px;border-bottom:1px solid var(--border)'>${h}</th>`).join('')}</tr></thead>
              <tbody>
                ${ rows.length ? rows.map(s=>`<tr><td style='padding:8px;border-bottom:1px solid #eee'>${formatDate(s.date)}</td><td style='padding:8px;border-bottom:1px solid #eee'>${(s.amount||0).toFixed(2)}</td><td style='padding:8px;border-bottom:1px solid #eee'>${s.category||'-'}</td><td style='padding:8px;border-bottom:1px solid #eee'>${s.description||'-'}</td></tr>`).join('') : `<tr><td colspan='4' class='hint' style='padding:8px'>${this.state.lang==='he'?'אין רישומים עדיין':'No records yet'}</td></tr>` }
              </tbody>
            </table>
          </div>
          <div style="margin-top:12px"><button class="btn" onclick="App.next()">${t('save_next')}</button></div>
        </section>`;
      }
      else if(this.state.screen==='insights'){
        const totalSaved=total; const msg = totalSaved>100 ? (this.state.lang==='he'?'כבר ניתן להתחיל לחסוך ולהשקיע.':'You can start saving and investing.') : (this.state.lang==='he'?'המשיכו בדילוגים קטנים כדי להגיע ליעד ולהתחיל להשקיע.':'Keep small skips to reach your goal and start investing.');
        html = `<section class="card">
          <h2>${t('insights')}</h2>
          <p class="hint">${t('total')}${totalSaved.toFixed(2)}</p>
          <p class="hint">${msg}</p>
          <div class="row" style="margin-top:12px">
            <button class="btn" onclick="App.push('investments')">${t('continue')}</button>
            <button class="btn" onclick="App.next()">${t('save_next')}</button>
          </div>
        </section>`;
      }
      else if(this.state.screen==='investments'){
        // 5 links depending on language
        const q_he=[
          'המושג ריבית דריבית',
          'למה כדאי להשקיע מגיל צעיר',
          'מה הם אפיקי ההשקעה הטובים ביותר',
          'פירוש המושג מניות',
          'פירוש המושג אג\"ח'
        ];
        const q_en=[
          'compound interest concept',
          'why invest from a young age',
          'best investment avenues',
          'definition of stock',
          'definition of bonds'
        ];
        const queries = this.state.lang==='he'?q_he:q_en;
        const tiles = queries.map((q,i)=>`<a class=\"tile\" href=\"${App.gQuery(q)}\" target=\"_blank\" rel=\"noopener noreferrer\">${q}</a>`).join('');
        html = `<section class="card">
          <h2>${t('investments')}</h2>
          <div class="grid" style="margin-top:8px">${tiles}</div>
          <div class="row" style="margin-top:12px">
            <button class="btn" onclick="App.push('summary')">${t('continue')}</button>
            <button class="btn" onclick="App.next()">${t('save_next')}</button>
          </div>
        </section>`;
      }
      else if(this.state.screen==='summary'){
        const count=this.state.data.length; const totalSaved=this.state.data.reduce((s,x)=>s+(x.amount||0),0);
        html = `<section class="card" style="text-align:center">
          <h2>Summary</h2>
          <p class="hint">${this.state.lang==='he'?'מספר דילוגים':'Skips'}: ${count}</p>
          <p class="hint">${t('total')}${totalSaved.toFixed(2)}</p>
          <div class="row" style="margin-top:12px;justify-content:center">
            <button class="btn" onclick="App.goHome()">${t('home')}</button>
            <button class="btn" onclick="App.next()">${t('save_next')}</button>
          </div>
        </section>`;
      }
      else if(this.state.screen==='settings'){
        const u=this.state.user||{firstName:'-',age:'-',goal:'-',purpose:'-'};
        html = `<section class="card">
          <h2>${t('settings')}</h2>
          <p class="hint">${t('name')}: ${u.firstName} • ${t('age')}: ${u.age} • ${t('goal')}: ₪${u.goal} • ${t('purpose')}: ${u.purpose}</p>
          <div class="row" style="margin-top:10px;flex-wrap:wrap">
            <button class="btn" style="background:linear-gradient(90deg,var(--honey),var(--peach));color:#1F2937" onclick="App.reset()">${t('reset_all')}</button>
            <button class="btn" onclick="App.next()">${t('save_next')}</button>
          </div>
          <hr style="margin:16px 0;border:none;border-top:1px solid var(--border)"/>
          <h3>${t('terms_title')}</h3>
          <p class="hint">${t('terms_text')}</p>
        </section>`;
      }
      el.innerHTML = html;
    }
  };

  if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }
  App.load();
  </script>
</body>
</html>
